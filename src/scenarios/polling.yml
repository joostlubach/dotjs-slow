name: polling
title: Polling

stage: interior
initial_positions:
  marie: counter_left
  etienne: entrance
  chef: kitchen

bootstrap: |-
  etienne.hungry()

codes:
  etienne: |-
    etienne.onHungry = function () {
      const server = restaurant.waitInLine()

      server.orderAsync('🍔', [
        '🧀',
        '🧀',
        '🥑',
        '🍅',
        '🥓',
        '🥓'
      ])

      let hamburger
      while (hamburger == null) {
        this.waitAtTable()
        hamburger = server.checkDone()
      }

      this.eat(hamburger)
    }

  marie: |-
    marie.onOrder = function (what, condiments) {
      if (what === '🍔') {
        chef.requestHamburgerAsync(condiments)
      }
    }

    marie.onCheckDone = function () {
      return chef.checkDone()
    }

  chef: |-
    chef.onRequestHamburger = function(condiments) {
      this.hamburger = null

      const rawPatty = this.takePatty()
      const patty = this.cook(rawPatty)

      const bun = this.takeBun()
      const extra = condiments.map(condiment =>
        this.takeCondiment(condiment)
      )
      
      this.hamburger = this.makeHamburger(patty, bun, extra)
    }

    chef.onCheckDone = function () {
      return this.hamburger
    }