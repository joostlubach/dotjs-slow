name: promise
title: Promise

stage: interior
initial_positions:
  marie: counter_left
  etienne: entrance
  chef: counter_right

bootstrap: |-
  etienne.hungry()

codes:
  etienne: |-
    etienne.onHungry = function () {
      const server = restaurant.waitInLine()

      const promise = server.orderPromise('🍔', [
        '🧀',
        '🍅',
        '🥓'
      ])

      promise.then(hamburger => {
        this.eat(hamburger)
      })

      this.waitAtTable()
    }

  marie: |-
    marie.onOrder = function (what, condiments) {
      if (what === '🍔') {
        return chef.requestHamburgerPromise(condiments)
      }
    }

  chef: |-
    chef.onRequestHamburger = function(condiments) {
      return new Promise(resolve => {
        const rawPatty = this.takePatty()
        const patty = this.cook(rawPatty)

        const bun = this.takeBun()
        const extra = condiments.map(condiment =>
          this.takeCondiment(condiment)
        )
        
        resolve(this.makeHamburger(patty, bun, extra))
      })
    }