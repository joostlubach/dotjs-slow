name: callback
title: Callback

stage: interior
initial_positions:
  marie: counter_left
  etienne: entrance
  chef: counter_right

bootstrap: |-
  etienne.hungry()

codes:
  etienne: |-
    etienne.onHungry = function () {
      const server = restaurant.waitInLine()

      server.orderCallback('ðŸ”', [
        'ðŸ§€',
        'ðŸ…',
        'ðŸ¥“'
      ], hamburger => {
        this.eat(hamburger)  
      })

      this.waitAtTable()
    }

  marie: |-
    marie.onOrder = function (what, condiments, callback) {
      if (what === 'ðŸ”') {
        chef.requestHamburgerCallback(condiments, hamburger => {
          callback(hamburger)
        })
      }
    }

  chef: |-
    chef.onRequestHamburger = function(condiments, callback) {
      const rawPatty = this.takePatty()
      const patty = this.cook(rawPatty)

      const bun = this.takeBun()
      const extra = condiments.map(condiment =>
        this.takeCondiment(condiment)
      )
      
      callback(this.makeHamburger(patty, bun, extra))
    }